{"ast":null,"code":"var _jsxFileName = \"D:\\\\PDM\\\\IonicApp\\\\myApp\\\\src\\\\todo\\\\BuyTicket.tsx\";\nimport React, { useContext, useEffect, useState } from 'react';\nimport { IonButton, IonButtons, IonContent, IonFab, IonFabButton, IonHeader, IonPage, IonTitle, IonToolbar, IonIcon, IonGrid, IonRow, IonCol, IonImg, IonActionSheet, createAnimation } from '@ionic/react';\nimport { getLogger } from '../core';\nimport { TrainContext } from './TrainProvider';\nimport { Plugins } from \"@capacitor/core\";\nimport { camera, trash, close, star } from 'ionicons/icons';\nimport { TrainDetails } from \"./Train\";\nimport { usePhotoGallery } from \"./usePhotoGallery\";\nimport { AuthContext } from \"../auth\";\nimport { MapComponent } from \"./MapComponent\";\nimport { useMyLocation } from \"./useMyLocation\";\nconst log = getLogger('ItemEdit');\n\nconst ItemEdit = ({\n  history,\n  match\n}) => {\n  var _myLocation$position;\n\n  const {\n    trains,\n    buying,\n    buyingError,\n    buyTicket\n  } = useContext(TrainContext);\n  const {\n    token\n  } = useContext(AuthContext);\n  const [text, setText] = useState('');\n  const [item, setItem] = useState();\n  const [localItem, setLocalItem] = useState();\n  const [imgPath, setImgPath] = useState(\"\");\n  const {\n    photos,\n    takePhoto,\n    deletePhoto,\n    uploadPhoto\n  } = usePhotoGallery();\n  const [photoToDelete, setPhotoToDelete] = useState(); // const [latitude, setLatitude] = useState(47.65371);\n  // const [longitude, setLongitude] = useState(24.548178);\n\n  const myLocation = useMyLocation();\n  const {\n    latitude: lat,\n    longitude: lng\n  } = ((_myLocation$position = myLocation.position) === null || _myLocation$position === void 0 ? void 0 : _myLocation$position.coords) || {};\n  const [latitude, setLatitude] = useState(47.65371);\n  const [longitude, setLongitude] = useState(24.548178);\n  useEffect(() => {\n    setLatitude(Number(lat));\n    setLongitude(Number(lng));\n  });\n  useEffect(() => {\n    log('useEffect');\n    const routeId = match.params.id || '';\n    const item = trains === null || trains === void 0 ? void 0 : trains.find(it => it._id === routeId);\n    setItem(item);\n\n    if (item) {\n      log('Exista');\n    } else {\n      log(\"Nu exista, incercam local\");\n      getLocal(routeId);\n    }\n  }, [match.params.id, trains]);\n\n  function getLocal(routeId) {\n    (async () => {\n      const {\n        Storage\n      } = Plugins;\n      const res = await Storage.get({\n        key: routeId\n      });\n\n      if (res.value) {\n        console.log('Train found', JSON.parse(res.value));\n        setItem(JSON.parse(res.value));\n      } else {\n        console.log('Train not found');\n      }\n    })();\n  }\n\n  const handleBuy = () => {\n    const editedItem = item;\n\n    if (item) {\n      item.imgSrc = imgPath;\n      buyTicket && buyTicket(item).then(() => history.goBack());\n    }\n  };\n\n  log('render');\n  useEffect(() => {\n    async function groupedAnimation() {\n      const saveButtonAnimation = createAnimation().addElement(document.getElementsByClassName(\"button-save\")[0]).duration(1000).direction('alternate').iterations(Infinity).keyframes([{\n        offset: 0,\n        opacity: '0.6',\n        transform: 'scale(0.7)'\n      }, {\n        offset: 1,\n        opacity: '0.99',\n        transform: 'scale(1)'\n      }]);\n      const deleteButtonAnimation = createAnimation().addElement(document.getElementsByClassName(\"button-delete\")[0]).duration(1000).direction('alternate').iterations(Infinity).keyframes([{\n        offset: 0,\n        opacity: '0.6',\n        transform: 'scale(0.7)'\n      }, {\n        offset: 1,\n        opacity: '0.99',\n        transform: 'scale(1)'\n      }]);\n      const parentAnipation = createAnimation().duration(1000).iterations(Infinity).direction('alternate').addAnimation([saveButtonAnimation, deleteButtonAnimation]);\n      parentAnipation.play();\n    }\n\n    groupedAnimation();\n  }, []);\n  return /*#__PURE__*/React.createElement(IonPage, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 130,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(IonHeader, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 131,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(IonToolbar, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 132,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(IonTitle, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 133,\n      columnNumber: 21\n    }\n  }, \"Edit\"), /*#__PURE__*/React.createElement(IonButtons, {\n    slot: \"end\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(IonButton, {\n    onClick: handleBuy,\n    className: \"button-save\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 135,\n      columnNumber: 25\n    }\n  }, \"Buy\")))), /*#__PURE__*/React.createElement(IonContent, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(MapComponent, {\n    lat: latitude,\n    lng: longitude,\n    onMapClick: location => {\n      setLatitude(location.latLng.lat());\n      setLongitude(location.latLng.lng());\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 142,\n      columnNumber: 17\n    }\n  }), item && /*#__PURE__*/React.createElement(TrainDetails, {\n    _id: item._id,\n    from: item.from,\n    to: item.to,\n    timeLeave: item.timeLeave,\n    timeArrive: item.timeArrive,\n    nrSeats: item.nrSeats,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 21\n    }\n  }), item && /*#__PURE__*/React.createElement(\"img\", {\n    src: item === null || item === void 0 ? void 0 : item.imgSrc,\n    alt: \"no image\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 154,\n      columnNumber: 21\n    }\n  }), /*#__PURE__*/React.createElement(IonGrid, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 156,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(IonRow, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 157,\n      columnNumber: 21\n    }\n  }, photos.map((photo, index) => /*#__PURE__*/React.createElement(IonCol, {\n    size: \"6\",\n    key: index,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 159,\n      columnNumber: 29\n    }\n  }, /*#__PURE__*/React.createElement(IonImg, {\n    onClick: () => setPhotoToDelete(photo),\n    src: photo.webviewPath,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 160,\n      columnNumber: 33\n    }\n  }))))), /*#__PURE__*/React.createElement(IonFab, {\n    vertical: \"bottom\",\n    horizontal: \"center\",\n    slot: \"fixed\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 166,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(IonFabButton, {\n    onClick: () => {\n      const photoTaken = takePhoto();\n      photoTaken.then(data => {\n        setImgPath(data.webviewPath);\n      });\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 167,\n      columnNumber: 21\n    }\n  }, /*#__PURE__*/React.createElement(IonIcon, {\n    icon: camera,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 173,\n      columnNumber: 25\n    }\n  }))), /*#__PURE__*/React.createElement(IonActionSheet, {\n    isOpen: !!photoToDelete,\n    buttons: [{\n      text: 'Upload',\n      icon: star,\n      handler: () => {\n        handleBuy();\n      }\n    }, {\n      text: 'Delete',\n      role: 'destructive',\n      icon: trash,\n      cssClass: \"button-delete\",\n      handler: () => {\n        if (photoToDelete) {\n          deletePhoto(photoToDelete);\n          setPhotoToDelete(undefined);\n        }\n      }\n    }, {\n      text: 'Cancel',\n      icon: close,\n      role: 'cancel'\n    }],\n    onDidDismiss: () => setPhotoToDelete(undefined),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 176,\n      columnNumber: 17\n    }\n  })));\n};\n\nexport default ItemEdit;","map":{"version":3,"sources":["D:/PDM/IonicApp/myApp/src/todo/BuyTicket.tsx"],"names":["React","useContext","useEffect","useState","IonButton","IonButtons","IonContent","IonFab","IonFabButton","IonHeader","IonPage","IonTitle","IonToolbar","IonIcon","IonGrid","IonRow","IonCol","IonImg","IonActionSheet","createAnimation","getLogger","TrainContext","Plugins","camera","trash","close","star","TrainDetails","usePhotoGallery","AuthContext","MapComponent","useMyLocation","log","ItemEdit","history","match","trains","buying","buyingError","buyTicket","token","text","setText","item","setItem","localItem","setLocalItem","imgPath","setImgPath","photos","takePhoto","deletePhoto","uploadPhoto","photoToDelete","setPhotoToDelete","myLocation","latitude","lat","longitude","lng","position","coords","setLatitude","setLongitude","Number","routeId","params","id","find","it","_id","getLocal","Storage","res","get","key","value","console","JSON","parse","handleBuy","editedItem","imgSrc","then","goBack","groupedAnimation","saveButtonAnimation","addElement","document","getElementsByClassName","duration","direction","iterations","Infinity","keyframes","offset","opacity","transform","deleteButtonAnimation","parentAnipation","addAnimation","play","location","latLng","from","to","timeLeave","timeArrive","nrSeats","map","photo","index","webviewPath","photoTaken","data","icon","handler","role","cssClass","undefined"],"mappings":"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","sourcesContent":["import React, { useContext, useEffect, useState } from 'react';\r\nimport {\r\n    IonButton,\r\n    IonButtons,\r\n    IonContent, IonFab, IonFabButton,\r\n    IonHeader,\r\n    IonInput, IonList,\r\n    IonLoading,\r\n    IonPage,\r\n    IonTitle,\r\n    IonToolbar,\r\n    IonIcon, IonGrid, IonRow, IonCol, IonImg, IonActionSheet, createAnimation\r\n} from '@ionic/react';\r\nimport { getLogger } from '../core';\r\nimport { TrainContext } from './TrainProvider';\r\nimport { RouteComponentProps } from 'react-router';\r\nimport { TrainProps } from './TrainProps';\r\nimport {Plugins} from \"@capacitor/core\";\r\nimport {camera, trash, close, star} from 'ionicons/icons';\r\n\r\nimport Train, {TrainDetails} from \"./Train\";\r\nimport {Photo, usePhotoGallery} from \"./usePhotoGallery\";\r\nimport {AuthContext} from \"../auth\";\r\nimport {MapComponent} from \"./MapComponent\";\r\nimport {useMyLocation} from \"./useMyLocation\";\r\n\r\nconst log = getLogger('ItemEdit');\r\n\r\ninterface ItemEditProps extends RouteComponentProps<{\r\n    id?: string;\r\n}> {}\r\n\r\nconst ItemEdit: React.FC<ItemEditProps> = ({ history, match }) => {\r\n    const { trains, buying, buyingError, buyTicket } = useContext(TrainContext);\r\n    const {token} = useContext(AuthContext);\r\n    const [text, setText] = useState('');\r\n    const [item, setItem] = useState<TrainProps>();\r\n    const [localItem, setLocalItem] = useState<TrainProps>();\r\n    const [imgPath, setImgPath] = useState(\"\");\r\n\r\n    const { photos, takePhoto, deletePhoto, uploadPhoto } = usePhotoGallery();\r\n    const [photoToDelete, setPhotoToDelete] = useState<Photo>();\r\n\r\n\r\n    // const [latitude, setLatitude] = useState(47.65371);\r\n    // const [longitude, setLongitude] = useState(24.548178);\r\n\r\n    const myLocation = useMyLocation();\r\n    const { latitude: lat, longitude: lng } = myLocation.position?.coords || {}\r\n    const [latitude, setLatitude] = useState(47.65371);\r\n    const [longitude, setLongitude] = useState(24.548178);\r\n\r\n    useEffect(()=>{\r\n        setLatitude(Number(lat));\r\n        setLongitude(Number(lng));\r\n    });\r\n\r\n    useEffect(() => {\r\n        log('useEffect');\r\n        const routeId = match.params.id || '';\r\n        const item = trains?.find(it => it._id === routeId);\r\n        setItem(item);\r\n        if (item) {\r\n            log('Exista');\r\n        }else {\r\n            log(\"Nu exista, incercam local\")\r\n            getLocal(routeId);\r\n        }\r\n    }, [match.params.id, trains]);\r\n\r\n    function getLocal(routeId: string){\r\n        (async () => {\r\n            const {Storage} = Plugins;\r\n            const res = await Storage.get({key: routeId});\r\n            if (res.value) {\r\n                console.log('Train found', JSON.parse(res.value));\r\n                setItem(JSON.parse(res.value));\r\n            } else {\r\n                console.log('Train not found');\r\n            }\r\n        })();\r\n    }\r\n\r\n    const handleBuy = () => {\r\n        const editedItem = item;\r\n        if(item) {\r\n            item.imgSrc = imgPath;\r\n            buyTicket && buyTicket(item).then(() => history.goBack());\r\n        }\r\n    };\r\n    log('render');\r\n\r\n\r\n    useEffect(() => {\r\n        async function groupedAnimation() {\r\n            const saveButtonAnimation = createAnimation()\r\n                .addElement(document.getElementsByClassName(\"button-save\")[0])\r\n                .duration(1000)\r\n                .direction('alternate')\r\n                .iterations(Infinity)\r\n                .keyframes([\r\n                    {offset: 0, opacity: '0.6', transform: 'scale(0.7)'},\r\n                    {offset: 1, opacity: '0.99', transform: 'scale(1)'}\r\n                ])\r\n\r\n            const deleteButtonAnimation = createAnimation()\r\n                .addElement(document.getElementsByClassName(\"button-delete\")[0])\r\n                .duration(1000)\r\n                .direction('alternate')\r\n                .iterations(Infinity)\r\n                .keyframes([\r\n                    {offset: 0, opacity: '0.6', transform: 'scale(0.7)'},\r\n                    {offset: 1, opacity: '0.99', transform: 'scale(1)'}\r\n                ])\r\n\r\n            const parentAnipation = createAnimation()\r\n                .duration(1000)\r\n                .iterations(Infinity)\r\n                .direction('alternate')\r\n                .addAnimation([saveButtonAnimation, deleteButtonAnimation])\r\n\r\n\r\n            parentAnipation.play();\r\n        }\r\n\r\n        groupedAnimation();\r\n    }, [])\r\n\r\n    return (\r\n        <IonPage>\r\n            <IonHeader>\r\n                <IonToolbar>\r\n                    <IonTitle>Edit</IonTitle>\r\n                    <IonButtons slot=\"end\">\r\n                        <IonButton onClick={handleBuy} className = \"button-save\">\r\n                            Buy\r\n                        </IonButton>\r\n                    </IonButtons>\r\n                </IonToolbar>\r\n            </IonHeader>\r\n            <IonContent>\r\n                <MapComponent\r\n                    lat={latitude}\r\n                    lng={longitude}\r\n                    onMapClick={(location: any) => {\r\n                        setLatitude(location.latLng.lat());\r\n                        setLongitude(location.latLng.lng());\r\n                    }}\r\n                />\r\n                {item && (\r\n                    <TrainDetails _id={item._id} from={item.from} to={item.to} timeLeave={item.timeLeave} timeArrive={item.timeArrive} nrSeats={item.nrSeats}/>\r\n                )}\r\n                {item && (\r\n                    <img src={item?.imgSrc} alt=\"no image\"/>\r\n                )}\r\n                <IonGrid>\r\n                    <IonRow>\r\n                        {photos.map((photo, index) => (\r\n                            <IonCol size=\"6\" key={index}>\r\n                                <IonImg onClick={() => setPhotoToDelete(photo)}\r\n                                        src={photo.webviewPath}/>\r\n                            </IonCol>\r\n                        ))}\r\n                    </IonRow>\r\n                </IonGrid>\r\n                <IonFab vertical=\"bottom\" horizontal=\"center\" slot=\"fixed\">\r\n                    <IonFabButton onClick={() => {\r\n                        const photoTaken = takePhoto();\r\n                        photoTaken.then((data) => {\r\n                            setImgPath(data.webviewPath!);\r\n                        })\r\n                    }}>\r\n                        <IonIcon icon={camera}></IonIcon>\r\n                    </IonFabButton>\r\n                </IonFab>\r\n                <IonActionSheet\r\n                    isOpen={!!photoToDelete}\r\n                    buttons={[{\r\n                        text: 'Upload',\r\n                        icon: star,\r\n                        handler: () => {\r\n                            handleBuy();\r\n                        }\r\n                    },{\r\n                        text: 'Delete',\r\n                        role: 'destructive',\r\n                        icon: trash,\r\n                        cssClass: \"button-delete\",\r\n                        handler: () => {\r\n                            if (photoToDelete) {\r\n                                deletePhoto(photoToDelete);\r\n                                setPhotoToDelete(undefined);\r\n                            }\r\n                        }\r\n                    }, {\r\n                        text: 'Cancel',\r\n                        icon: close,\r\n                        role: 'cancel'\r\n                    }]}\r\n                    onDidDismiss={() => setPhotoToDelete(undefined)}\r\n                />\r\n            </IonContent>\r\n        </IonPage>\r\n    );\r\n};\r\n\r\nexport default ItemEdit;\r\n"]},"metadata":{},"sourceType":"module"}