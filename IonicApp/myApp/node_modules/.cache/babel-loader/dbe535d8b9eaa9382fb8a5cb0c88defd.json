{"ast":null,"code":"import { useCamera } from '@ionic/react-hooks/camera';\nimport { CameraResultType, CameraSource, FilesystemDirectory } from '@capacitor/core';\nimport { useEffect, useState } from 'react';\nimport { base64FromPath, useFilesystem } from '@ionic/react-hooks/filesystem';\nimport { useStorage } from '@ionic/react-hooks/storage';\nconst PHOTO_STORAGE = 'photos';\nexport function usePhotoGallery() {\n  const {\n    getPhoto\n  } = useCamera();\n  const [photos, setPhotos] = useState([]);\n\n  const takePhoto = async () => {\n    const cameraPhoto = await getPhoto({\n      resultType: CameraResultType.Uri,\n      source: CameraSource.Camera,\n      quality: 100\n    });\n    const fileName = new Date().getTime() + '.jpeg';\n    const savedFileImage = await savePicture(cameraPhoto, fileName);\n    const newPhotos = [savedFileImage, ...photos];\n    setPhotos(newPhotos);\n    set(PHOTO_STORAGE, JSON.stringify(newPhotos));\n  };\n\n  const {\n    deleteFile,\n    readFile,\n    writeFile\n  } = useFilesystem();\n\n  const savePicture = async (photo, fileName) => {\n    const base64Data = await base64FromPath(photo.webPath);\n    await writeFile({\n      path: fileName,\n      data: base64Data,\n      directory: FilesystemDirectory.Data\n    });\n    return {\n      filepath: fileName,\n      webviewPath: photo.webPath\n    };\n  };\n\n  const {\n    get,\n    set\n  } = useStorage();\n  useEffect(() => {\n    const loadSaved = async () => {\n      const photosString = await get(PHOTO_STORAGE);\n      const photos = photosString ? JSON.parse(photosString) : [];\n\n      for (let photo of photos) {\n        const file = await readFile({\n          path: photo.filepath,\n          directory: FilesystemDirectory.Data\n        });\n        photo.webviewPath = `data:image/jpeg;base64,${file.data}`;\n      }\n\n      setPhotos(photos);\n    };\n\n    loadSaved();\n  }, [get, readFile]);\n\n  const deletePhoto = async photo => {\n    const newPhotos = photos.filter(p => p.filepath !== photo.filepath);\n    set(PHOTO_STORAGE, JSON.stringify(newPhotos));\n    const filename = photo.filepath.substr(photo.filepath.lastIndexOf('/') + 1);\n    await deleteFile({\n      path: filename,\n      directory: FilesystemDirectory.Data\n    });\n    setPhotos(newPhotos);\n  };\n\n  const uploadPhoto = async photo => {\n    const file = await readFile({\n      path: photo.filepath,\n      directory: FilesystemDirectory.Data\n    });\n    const formData = new FormData();\n    const imgBlob = new Blob([file.data], {\n      type: \".jpg\"\n    });\n    formData.append('file', imgBlob, photo.filepath);\n  };\n\n  return {\n    photos,\n    takePhoto,\n    deletePhoto\n  };\n}","map":{"version":3,"sources":["D:/PDM/IonicApp/myApp/src/todo/usePhotoGallery.tsx"],"names":["useCamera","CameraResultType","CameraSource","FilesystemDirectory","useEffect","useState","base64FromPath","useFilesystem","useStorage","PHOTO_STORAGE","usePhotoGallery","getPhoto","photos","setPhotos","takePhoto","cameraPhoto","resultType","Uri","source","Camera","quality","fileName","Date","getTime","savedFileImage","savePicture","newPhotos","set","JSON","stringify","deleteFile","readFile","writeFile","photo","base64Data","webPath","path","data","directory","Data","filepath","webviewPath","get","loadSaved","photosString","parse","file","deletePhoto","filter","p","filename","substr","lastIndexOf","uploadPhoto","formData","FormData","imgBlob","Blob","type","append"],"mappings":"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","sourcesContent":["import { useCamera } from '@ionic/react-hooks/camera';\r\nimport { CameraPhoto, CameraResultType, CameraSource, FilesystemDirectory } from '@capacitor/core';\r\nimport { useEffect, useState } from 'react';\r\nimport { base64FromPath, useFilesystem } from '@ionic/react-hooks/filesystem';\r\nimport { useStorage } from '@ionic/react-hooks/storage';\r\n\r\nexport interface Photo {\r\n  filepath: string;\r\n  webviewPath?: string;\r\n}\r\n\r\nconst PHOTO_STORAGE = 'photos';\r\n\r\nexport function usePhotoGallery() {\r\n  const { getPhoto } = useCamera();\r\n  const [photos, setPhotos] = useState<Photo[]>([]);\r\n\r\n  const takePhoto = async () => {\r\n    const cameraPhoto = await getPhoto({\r\n      resultType: CameraResultType.Uri,\r\n      source: CameraSource.Camera,\r\n      quality: 100\r\n    });\r\n    const fileName = new Date().getTime() + '.jpeg';\r\n    const savedFileImage = await savePicture(cameraPhoto, fileName);\r\n    const newPhotos = [savedFileImage, ...photos];\r\n    setPhotos(newPhotos);\r\n    set(PHOTO_STORAGE, JSON.stringify(newPhotos));\r\n  };\r\n\r\n  const { deleteFile, readFile, writeFile } = useFilesystem();\r\n  const savePicture = async (photo: CameraPhoto, fileName: string): Promise<Photo> => {\r\n    const base64Data = await base64FromPath(photo.webPath!);\r\n    await writeFile({\r\n      path: fileName,\r\n      data: base64Data,\r\n      directory: FilesystemDirectory.Data\r\n    });\r\n\r\n    return {\r\n      filepath: fileName,\r\n      webviewPath: photo.webPath\r\n    };\r\n  };\r\n\r\n  const { get, set } = useStorage();\r\n  useEffect(() => {\r\n    const loadSaved = async () => {\r\n      const photosString = await get(PHOTO_STORAGE);\r\n      const photos = (photosString ? JSON.parse(photosString) : []) as Photo[];\r\n      for (let photo of photos) {\r\n        const file = await readFile({\r\n          path: photo.filepath,\r\n          directory: FilesystemDirectory.Data\r\n        });\r\n        photo.webviewPath = `data:image/jpeg;base64,${file.data}`;\r\n      }\r\n      setPhotos(photos);\r\n    };\r\n    loadSaved();\r\n  }, [get, readFile]);\r\n\r\n  const deletePhoto = async (photo: Photo) => {\r\n    const newPhotos = photos.filter(p => p.filepath !== photo.filepath);\r\n    set(PHOTO_STORAGE, JSON.stringify(newPhotos));\r\n    const filename = photo.filepath.substr(photo.filepath.lastIndexOf('/') + 1);\r\n    await deleteFile({\r\n      path: filename,\r\n      directory: FilesystemDirectory.Data\r\n    });\r\n    setPhotos(newPhotos);\r\n  };\r\n\r\n  const uploadPhoto = async (photo: Photo) => {\r\n    const file = await readFile({\r\n      path: photo.filepath,\r\n      directory: FilesystemDirectory.Data\r\n    });\r\n    const formData = new FormData();\r\n    const imgBlob = new Blob([file.data], {\r\n      type: \".jpg\"\r\n    });\r\n    formData.append('file', imgBlob, photo.filepath);\r\n    \r\n  }\r\n\r\n\r\n  return {\r\n    photos,\r\n    takePhoto,\r\n    deletePhoto,\r\n  };\r\n}\r\n"]},"metadata":{},"sourceType":"module"}