{"ast":null,"code":"var _jsxFileName = \"D:\\\\PDM\\\\IonicApp\\\\myApp\\\\src\\\\todo\\\\Home.tsx\";\nimport { IonContent, IonHeader, IonInfiniteScroll, IonInfiniteScrollContent, IonList, IonLoading, IonPage, IonTitle, IonToolbar, useIonViewWillEnter } from \"@ionic/react\";\nimport React, { useContext, useState } from \"react\";\nimport Train from \"./Train\";\nimport { getLogger } from '../core';\nimport { TrainContext } from \"./TrainProvider\";\nimport { getTrains } from \"./TrainsAPI\";\nimport { AuthContext } from \"../auth\";\nconst log = getLogger('Home');\n\nconst Home = ({\n  history\n}) => {\n  let page = 0;\n  let {\n    trains,\n    fetching,\n    fetchingError\n  } = useContext(TrainContext);\n  const {\n    token\n  } = useContext(AuthContext);\n  const [disableInfiniteScroll, setDisableInfiniteScroll] = useState(false);\n\n  async function fetchItems() {\n    try {\n      log('fetchItems started');\n      const items = await getTrains(token);\n\n      if (items.length > 0) {\n        trains = items;\n        setDisableInfiniteScroll(trains.length < 10);\n      } else {\n        setDisableInfiniteScroll(true);\n      }\n\n      log('fetchItems succeeded');\n    } catch (error) {\n      log('fetchItems failed');\n    }\n  }\n\n  useIonViewWillEnter(async () => {\n    await fetchItems();\n  });\n\n  async function searchNext($event) {\n    //const {trains, fetching, fetchingError} = useContext(TrainContext);\n    log(\"searching Next\");\n    page++;\n    await fetchItems();\n\n    if (page === 10) {}\n\n    $event.target.complete();\n  }\n\n  log(\"Trains render...\");\n  return /*#__PURE__*/React.createElement(IonPage, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 63,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(IonHeader, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 64,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(IonToolbar, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 65,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(IonTitle, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 66,\n      columnNumber: 21\n    }\n  }, \"Student CFR\"))), /*#__PURE__*/React.createElement(IonContent, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 69,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(IonLoading, {\n    isOpen: fetching,\n    message: \"Fetching trains\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 17\n    }\n  }), trains && /*#__PURE__*/React.createElement(IonList, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 72,\n      columnNumber: 21\n    }\n  }, trains.map(({\n    _id,\n    from,\n    to,\n    nrSeats\n  }) => /*#__PURE__*/React.createElement(Train, {\n    key: _id,\n    _id: _id,\n    from: from,\n    to: to,\n    nrSeats: nrSeats,\n    onBuy: id => history.push(`/train/${id}`),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 74,\n      columnNumber: 29\n    }\n  }))), fetchingError && /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 21\n    }\n  }, fetchingError.message || 'Failed to fetch items'), /*#__PURE__*/React.createElement(IonInfiniteScroll, {\n    threshold: \"25%\",\n    disabled: disableInfiniteScroll,\n    onIonInfinite: e => searchNext(e),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(IonInfiniteScrollContent, {\n    loadingText: \"Loading more good doggos...\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 21\n    }\n  }))));\n};\n\nexport default Home;","map":{"version":3,"sources":["D:/PDM/IonicApp/myApp/src/todo/Home.tsx"],"names":["IonContent","IonHeader","IonInfiniteScroll","IonInfiniteScrollContent","IonList","IonLoading","IonPage","IonTitle","IonToolbar","useIonViewWillEnter","React","useContext","useState","Train","getLogger","TrainContext","getTrains","AuthContext","log","Home","history","page","trains","fetching","fetchingError","token","disableInfiniteScroll","setDisableInfiniteScroll","fetchItems","items","length","error","searchNext","$event","target","complete","map","_id","from","to","nrSeats","id","push","message","e"],"mappings":"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","sourcesContent":["import {\r\n    IonContent,\r\n    IonFab,\r\n    IonFabButton,\r\n    IonHeader,\r\n    IonIcon, IonInfiniteScroll, IonInfiniteScrollContent, IonList,\r\n    IonLoading,\r\n    IonPage,\r\n    IonTitle,\r\n    IonToolbar, useIonViewWillEnter\r\n} from \"@ionic/react\";\r\nimport React, {useContext, useState} from \"react\";\r\nimport Train from \"./Train\";\r\nimport { getLogger } from '../core';\r\nimport {add, train} from \"ionicons/icons\";\r\nimport {TrainContext} from \"./TrainProvider\";\r\nimport {RouteComponentProps} from \"react-router\";\r\nimport {getTrains} from \"./TrainsAPI\";\r\nimport {AuthContext} from \"../auth\";\r\n\r\nconst log = getLogger('Home');\r\n\r\nconst Home: React.FC<RouteComponentProps> = ({history}) =>{\r\n    let page = 0;\r\n\r\n    let {trains, fetching, fetchingError} = useContext(TrainContext);\r\n    const {token} = useContext(AuthContext);\r\n    const [disableInfiniteScroll, setDisableInfiniteScroll] = useState<boolean>(false);\r\n\r\n    async function fetchItems() {\r\n        try {\r\n            log('fetchItems started');\r\n            const items = await getTrains(token);\r\n            if(items.length > 0){\r\n                trains = items;\r\n                setDisableInfiniteScroll(trains.length < 10);\r\n            }else {\r\n                setDisableInfiniteScroll(true);\r\n            }\r\n            log('fetchItems succeeded');\r\n        } catch (error) {\r\n            log('fetchItems failed');\r\n        }\r\n    }\r\n\r\n    useIonViewWillEnter(async () => {\r\n        await fetchItems();\r\n    });\r\n\r\n    async function searchNext($event: CustomEvent<void>) {\r\n        //const {trains, fetching, fetchingError} = useContext(TrainContext);\r\n        log(\"searching Next\");\r\n        page++;\r\n        await fetchItems();\r\n        if(page === 10){\r\n            \r\n        }\r\n        ($event.target as HTMLIonInfiniteScrollElement).complete();\r\n    }\r\n\r\n    log(\"Trains render...\");\r\n    return(\r\n        <IonPage>\r\n            <IonHeader>\r\n                <IonToolbar>\r\n                    <IonTitle>Student CFR</IonTitle>\r\n                </IonToolbar>\r\n            </IonHeader>\r\n            <IonContent>\r\n                <IonLoading isOpen = {fetching} message = \"Fetching trains\"/>\r\n                {trains && (\r\n                    <IonList>\r\n                        {trains.map(({_id, from, to, nrSeats}) =>\r\n                            <Train key={_id} _id={_id} from={from} to={to} nrSeats={nrSeats} onBuy={id => history.push(`/train/${id}`)}/>)}\r\n                    </IonList>\r\n                )}\r\n                {fetchingError && (\r\n                    <div>{fetchingError.message || 'Failed to fetch items'}</div>\r\n                )}\r\n                <IonInfiniteScroll threshold=\"25%\" disabled={disableInfiniteScroll}\r\n                                   onIonInfinite={(e: CustomEvent<void>) => searchNext(e)}>\r\n                    <IonInfiniteScrollContent\r\n                        loadingText=\"Loading more good doggos...\">\r\n                    </IonInfiniteScrollContent>\r\n                </IonInfiniteScroll>\r\n            </IonContent>\r\n        </IonPage>\r\n    );\r\n};\r\n\r\nexport default Home;"]},"metadata":{},"sourceType":"module"}