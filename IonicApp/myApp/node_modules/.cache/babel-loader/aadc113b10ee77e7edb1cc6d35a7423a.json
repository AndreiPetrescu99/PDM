{"ast":null,"code":"import { getLogger } from \"../core\";\nimport axios from 'axios';\nconst log = getLogger('trainsAPI');\nconst baseURL = 'localhost:3000';\nconst trainURL = `http://${baseURL}/train`;\n\nfunction witLogs(promise, fnName) {\n  log(`${fnName} - started`);\n  return promise.then(res => {\n    log(`${fnName} - succeded`);\n    return Promise.resolve(res.data);\n  }).catch(err => {\n    log(`${fnName} - failed`);\n    return Promise.reject(err);\n  });\n}\n\nconst config = {\n  headers: {\n    'Content-Type': 'application/json'\n  }\n};\nexport const getTrains = () => {\n  return witLogs(axios.get(trainURL, config), 'getItems');\n};\nexport const updateTrain = train => {\n  return witLogs(axios.put(`${trainURL}/${train._id}`, train, config), 'updateTrain');\n};\nexport const createItem = item => {\n  return witLogs(axios.post(trainURL, item, config), 'createItem');\n};\nexport const newWebSocket = onMessage => {\n  const ws = new WebSocket(`ws://${baseURL}`);\n\n  ws.onopen = () => {\n    log('WebSocket onOpen');\n  };\n\n  ws.onclose = () => {\n    log('WebSocket onClose');\n  };\n\n  ws.onerror = () => {\n    log('WebSocket onError');\n  };\n\n  ws.onmessage = messageEvent => {\n    log('WebSocket onMessage');\n    onMessage(JSON.parse(messageEvent.data));\n  };\n\n  return () => {\n    ws.close();\n  };\n};","map":{"version":3,"sources":["D:/PDM/IonicApp/myApp/src/todo/TrainsAPI.tsx"],"names":["getLogger","axios","log","baseURL","trainURL","witLogs","promise","fnName","then","res","Promise","resolve","data","catch","err","reject","config","headers","getTrains","get","updateTrain","train","put","_id","createItem","item","post","newWebSocket","onMessage","ws","WebSocket","onopen","onclose","onerror","onmessage","messageEvent","JSON","parse","close"],"mappings":"AAAA,SAAQA,SAAR,QAAwB,SAAxB;AAEA,OAAOC,KAAP,MAAkB,OAAlB;AAEA,MAAMC,GAAG,GAAGF,SAAS,CAAC,WAAD,CAArB;AAEA,MAAMG,OAAO,GAAG,gBAAhB;AACA,MAAMC,QAAQ,GAAI,UAASD,OAAQ,QAAnC;;AAMA,SAASE,OAAT,CAAoBC,OAApB,EAAwDC,MAAxD,EAAkF;AAC9EL,EAAAA,GAAG,CAAE,GAAEK,MAAO,YAAX,CAAH;AACA,SAAOD,OAAO,CACTE,IADE,CACGC,GAAG,IAAI;AACTP,IAAAA,GAAG,CAAE,GAAEK,MAAO,aAAX,CAAH;AACA,WAAOG,OAAO,CAACC,OAAR,CAAgBF,GAAG,CAACG,IAApB,CAAP;AACH,GAJE,EAKFC,KALE,CAKIC,GAAG,IAAI;AACVZ,IAAAA,GAAG,CAAE,GAAEK,MAAO,WAAX,CAAH;AACA,WAAOG,OAAO,CAACK,MAAR,CAAeD,GAAf,CAAP;AACH,GARE,CAAP;AASH;;AAED,MAAME,MAAM,GAAG;AACXC,EAAAA,OAAO,EAAC;AACJ,oBAAgB;AADZ;AADG,CAAf;AAMA,OAAO,MAAMC,SAAsC,GAAG,MAAK;AACvD,SAAOb,OAAO,CAACJ,KAAK,CAACkB,GAAN,CAAUf,QAAV,EAAoBY,MAApB,CAAD,EAA8B,UAA9B,CAAd;AACH,CAFM;AAIP,OAAO,MAAMI,WAAyD,GAAGC,KAAK,IAAI;AAC9E,SAAOhB,OAAO,CAACJ,KAAK,CAACqB,GAAN,CAAW,GAAElB,QAAS,IAAGiB,KAAK,CAACE,GAAI,EAAnC,EAAsCF,KAAtC,EAA6CL,MAA7C,CAAD,EAAuD,aAAvD,CAAd;AACH,CAFM;AAIP,OAAO,MAAMQ,UAAuD,GAAGC,IAAI,IAAI;AAC3E,SAAOpB,OAAO,CAACJ,KAAK,CAACyB,IAAN,CAAWtB,QAAX,EAAqBqB,IAArB,EAA2BT,MAA3B,CAAD,EAAqC,YAArC,CAAd;AACH,CAFM;AAWP,OAAO,MAAMW,YAAY,GAAIC,SAAD,IAA4C;AACpE,QAAMC,EAAE,GAAG,IAAIC,SAAJ,CAAe,QAAO3B,OAAQ,EAA9B,CAAX;;AACA0B,EAAAA,EAAE,CAACE,MAAH,GAAY,MAAK;AACb7B,IAAAA,GAAG,CAAC,kBAAD,CAAH;AACH,GAFD;;AAGA2B,EAAAA,EAAE,CAACG,OAAH,GAAa,MAAK;AACd9B,IAAAA,GAAG,CAAC,mBAAD,CAAH;AACH,GAFD;;AAGA2B,EAAAA,EAAE,CAACI,OAAH,GAAa,MAAK;AACd/B,IAAAA,GAAG,CAAC,mBAAD,CAAH;AACH,GAFD;;AAGA2B,EAAAA,EAAE,CAACK,SAAH,GAAeC,YAAY,IAAG;AAC1BjC,IAAAA,GAAG,CAAC,qBAAD,CAAH;AACA0B,IAAAA,SAAS,CAACQ,IAAI,CAACC,KAAL,CAAWF,YAAY,CAACvB,IAAxB,CAAD,CAAT;AACH,GAHD;;AAIA,SAAO,MAAM;AACTiB,IAAAA,EAAE,CAACS,KAAH;AACH,GAFD;AAGH,CAlBM","sourcesContent":["import {getLogger} from \"../core\";\r\nimport {TrainProps} from \"./TrainProps\";\r\nimport axios from 'axios';\r\n\r\nconst log = getLogger('trainsAPI');\r\n\r\nconst baseURL = 'localhost:3000';\r\nconst trainURL = `http://${baseURL}/train`;\r\n\r\ninterface ResponseProps<T>{\r\n    data: T;\r\n}\r\n\r\nfunction witLogs<T>(promise: Promise<ResponseProps<T>>, fnName:string): Promise<T>{\r\n    log(`${fnName} - started`);\r\n    return promise\r\n        .then(res => {\r\n            log(`${fnName} - succeded`);\r\n            return Promise.resolve(res.data);\r\n        })\r\n        .catch(err => {\r\n            log(`${fnName} - failed`);\r\n            return Promise.reject(err);\r\n        });\r\n}\r\n\r\nconst config = {\r\n    headers:{\r\n        'Content-Type': 'application/json'\r\n    }\r\n};\r\n\r\nexport const getTrains: () => Promise<TrainProps[]> = () =>{\r\n    return witLogs(axios.get(trainURL, config), 'getItems');\r\n};\r\n\r\nexport const updateTrain: (train: TrainProps) => Promise<TrainProps[]> = train => {\r\n    return witLogs(axios.put(`${trainURL}/${train._id}`, train, config), 'updateTrain');\r\n};\r\n\r\nexport const createItem: (item: TrainProps) => Promise<TrainProps[]> = item => {\r\n    return witLogs(axios.post(trainURL, item, config), 'createItem');\r\n}\r\n\r\ninterface MessageData{\r\n    event: string;\r\n    payload:{\r\n        train: TrainProps\r\n    };\r\n}\r\n\r\nexport const newWebSocket = (onMessage: (data: MessageData) => void) => {\r\n    const ws = new WebSocket(`ws://${baseURL}`);\r\n    ws.onopen = () =>{\r\n        log('WebSocket onOpen');\r\n    }\r\n    ws.onclose = () =>{\r\n        log('WebSocket onClose');\r\n    }\r\n    ws.onerror = () =>{\r\n        log('WebSocket onError');\r\n    }\r\n    ws.onmessage = messageEvent =>{\r\n        log('WebSocket onMessage');\r\n        onMessage(JSON.parse(messageEvent.data));\r\n    };\r\n    return () => {\r\n        ws.close();\r\n    }\r\n}"]},"metadata":{},"sourceType":"module"}